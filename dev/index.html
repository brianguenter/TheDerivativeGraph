<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>The Derivative Graph and its use · TheDerivativeGraph</title><meta name="title" content="The Derivative Graph and its use · TheDerivativeGraph"/><meta property="og:title" content="The Derivative Graph and its use · TheDerivativeGraph"/><meta property="twitter:title" content="The Derivative Graph and its use · TheDerivativeGraph"/><meta name="description" content="Documentation for TheDerivativeGraph."/><meta property="og:description" content="Documentation for TheDerivativeGraph."/><meta property="twitter:description" content="Documentation for TheDerivativeGraph."/><script data-outdated-warner src="assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="assets/documenter.js"></script><script src="search_index.js"></script><script src="siteinfo.js"></script><script src="../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href>TheDerivativeGraph</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li class="is-active"><a class="tocitem" href>The Derivative Graph and its use</a><ul class="internal"><li><a class="tocitem" href="#The-Chain-Rule-and-the-Derivative-Graph"><span>The Chain Rule and the Derivative Graph</span></a></li><li><a class="tocitem" href="#Creating-an-AD-algorithm-from-scratch"><span>Creating an AD algorithm from scratch</span></a></li><li><a class="tocitem" href="#Explicit-Factorization-and-the-FD-algorithm"><span>Explicit Factorization and the FD algorithm</span></a></li><li><a class="tocitem" href="#Jv,-vᵀJ,-and-Hv"><span>Jv, vᵀJ, and Hv</span></a></li></ul></li><li><a class="tocitem" href="thederivativegraph/">The Derivative Graph</a></li><li><span class="tocitem">Tensor Derivatives</span><ul><li><a class="tocitem" href="tensorintro/">Introduction</a></li><li><input class="collapse-toggle" id="menuitem-3-2" type="checkbox"/><label class="tocitem" for="menuitem-3-2"><span class="docs-label">Examples</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="matvec/">Matrix vector multiplication</a></li><li><a class="tocitem" href="matmat/">Matrix matrix multiplication</a></li><li><a class="tocitem" href="convolution/">Convolution</a></li></ul></li><li><a class="tocitem" href="theory/">Theory</a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>The Derivative Graph and its use</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>The Derivative Graph and its use</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/brianguenter/TheDerivativeGraph" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/brianguenter/TheDerivativeGraph/blob/main/docs/src/index.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="The-Derivative-Graph-and-its-use"><a class="docs-heading-anchor" href="#The-Derivative-Graph-and-its-use">The Derivative Graph and its use</a><a id="The-Derivative-Graph-and-its-use-1"></a><a class="docs-heading-anchor-permalink" href="#The-Derivative-Graph-and-its-use" title="Permalink"></a></h1><p>The derivative graph is a data structure that represents the derivative of a function as a graph. It is both a means of implementing efficient automatic differentiation (AD) algorithms and a more perspicuous way of analyzing and understanding these algorithms. The derivative graph is a powerful new tool which gives the developer great flexibility when designing new general purpose AD systems.</p><p>In this document you will learn</p><ul><li>how the derivative graph is related to the original function graph. </li><li>how the derivative graph is derived from the chain rule of Calculus.</li><li>that there is no fundamental difference between symbolic differentiation and automatic differentiation. You may be surprised to learn that the most efficient AD algorithms are purely symbolic.</li><li>how to design efficient AD algorithms using a few simple heuristics.</li><li>how forward and reverse are essentially the same. </li><li>how to improve on forward and reverse with an AD algorithm that computes efficient derivatives for any Rⁿ-&gt;Rᵐ.</li><li>how algorithms for computing Jv, vᵀJ, and Hv, are structurally identical; they all reduce to simple edge insertion in the derivative graph. </li></ul><p>&lt;p style=&quot;text-align: center;&quot;&gt; One path through derivative graph relating \partial  &lt;/p&gt;</p><h2 id="The-Chain-Rule-and-the-Derivative-Graph"><a class="docs-heading-anchor" href="#The-Chain-Rule-and-the-Derivative-Graph">The Chain Rule and the Derivative Graph</a><a id="The-Chain-Rule-and-the-Derivative-Graph-1"></a><a class="docs-heading-anchor-permalink" href="#The-Chain-Rule-and-the-Derivative-Graph" title="Permalink"></a></h2><p>sum of products of terms where each term is a partial derivative a of function node wrt to one of its children.</p><h3 id="What-is-Automatic-Differentiation-anyway?"><a class="docs-heading-anchor" href="#What-is-Automatic-Differentiation-anyway?">What is Automatic Differentiation anyway?</a><a id="What-is-Automatic-Differentiation-anyway?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-Automatic-Differentiation-anyway?" title="Permalink"></a></h3><p>What is automatic differentiation? An algorithm which computes the sum of products of the edges in the derivative graph, while treating the derivative values at the edges as opaque quantities. The goal of AD algorithm development is to minimize the number of additions and multiplications required to evaluate the sum of products. There are only two ways to do this: factor out common terms and compute common subexpressions so that expressions that are more commonly used are computed before less commonly used expressions. Example:</p><h2 id="Creating-an-AD-algorithm-from-scratch"><a class="docs-heading-anchor" href="#Creating-an-AD-algorithm-from-scratch">Creating an AD algorithm from scratch</a><a id="Creating-an-AD-algorithm-from-scratch-1"></a><a class="docs-heading-anchor-permalink" href="#Creating-an-AD-algorithm-from-scratch" title="Permalink"></a></h2><h3 id="R-Rⁿ"><a class="docs-heading-anchor" href="#R-Rⁿ">R¹-&gt;Rⁿ</a><a id="R-Rⁿ-1"></a><a class="docs-heading-anchor-permalink" href="#R-Rⁿ" title="Permalink"></a></h3><p><img src="illustrations/Forward_binary_tree_bin_path1.svg" alt="Path 1"/> <img src="illustrations/Forward_binary_tree_bin_path2.svg" alt="Path 2"/></p><p><img src="illustrations/Forward_binary_tree_Dterm_weights.svg" alt="Path 3"/></p><p><img src="illustrations/Forward_binary_tree_Dterm_weights.svg" alt="Path 3"/> <img src="illustrations/Forward_binary_tree_Dterm_weightsD.svg" alt="Path 3"/></p><h3 id="Rⁿ-R"><a class="docs-heading-anchor" href="#Rⁿ-R">Rⁿ-&gt;R¹</a><a id="Rⁿ-R-1"></a><a class="docs-heading-anchor-permalink" href="#Rⁿ-R" title="Permalink"></a></h3><h3 id="Forward-and-Reverse"><a class="docs-heading-anchor" href="#Forward-and-Reverse">Forward and Reverse</a><a id="Forward-and-Reverse-1"></a><a class="docs-heading-anchor-permalink" href="#Forward-and-Reverse" title="Permalink"></a></h3><p>Congratulations, with two simple heuristics you have just derived the forward and reverse AD algorithms. When seen as operations on the derivative graph it is clear that these two algorithms are essentially the same. </p><p>Let&#39;s number the edges in the graph by postorder (explanation.). In our sum of products expressions let&#39;s order the terms in each product with smallest postorder number to the left. With this convention edges that are lower in the graph will always appear as prefixes of product terms and similarly edges higher in the graph will be suffixes. Example.</p><p>Now the fundamental similarity, and difference, between forward and reverse is clear. Forward factors out common <em>suffix</em> terms but computes <em>prefix</em> subproducts first. Reverse factors out common <em>prefix</em> terms but computes <em>suffix</em> subproducts first.</p><p>What makes understanding forward and reverse difficult is, first, they <em>implicitly</em> factor the derivative graph, and, second, they also <em>implicitly</em> compute the most used commonly subexpressions first. It is remarkable that nearly optimal factorization and common subexpression evaluation naturally arise from these simple forward or reverse traversals of the derivative graph.</p><p>This simplicity and efficiency only miraculously aligns for functions with special structure: f:Rⁿ-&gt;R¹ for reverse and f:R¹-&gt;Rⁿ for forward. In all other cases forward and reverse fail to optimally factor and order common subexpressions. For f:Rⁿ-&gt;Rᵐ in the worst case forward does n<em>|E| as much work as necessary; the factor for reverse is m</em>|E|.</p><p>Even in the best case forward and reverse can do more work than necessary (example showing prefix and suffix factorization)</p><h3 id="Implicit-Factorization"><a class="docs-heading-anchor" href="#Implicit-Factorization">Implicit Factorization</a><a id="Implicit-Factorization-1"></a><a class="docs-heading-anchor-permalink" href="#Implicit-Factorization" title="Permalink"></a></h3><h3 id="TimeUsed"><a class="docs-heading-anchor" href="#TimeUsed">TimeUsed</a><a id="TimeUsed-1"></a><a class="docs-heading-anchor-permalink" href="#TimeUsed" title="Permalink"></a></h3><h2 id="Explicit-Factorization-and-the-FD-algorithm"><a class="docs-heading-anchor" href="#Explicit-Factorization-and-the-FD-algorithm">Explicit Factorization and the FD algorithm</a><a id="Explicit-Factorization-and-the-FD-algorithm-1"></a><a class="docs-heading-anchor-permalink" href="#Explicit-Factorization-and-the-FD-algorithm" title="Permalink"></a></h2><h2 id="Jv,-vᵀJ,-and-Hv"><a class="docs-heading-anchor" href="#Jv,-vᵀJ,-and-Hv">Jv, vᵀJ, and Hv</a><a id="Jv,-vᵀJ,-and-Hv-1"></a><a class="docs-heading-anchor-permalink" href="#Jv,-vᵀJ,-and-Hv" title="Permalink"></a></h2></article><nav class="docs-footer"><a class="docs-footer-nextpage" href="thederivativegraph/">The Derivative Graph »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="auto">Automatic (OS)</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.0.1 on <span class="colophon-date" title="Saturday 23 September 2023 02:42">Saturday 23 September 2023</span>. Using Julia version 1.9.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
